<!DOCTYPE html>
<head>
	<title>
		ì˜ˆì•½ë“±ë¡ - ì •ë³´ì…ë ¥
	</title>
</head>
<th:block th:replace="~{ /layout/basic :: setContent(~{this::content})}">
<th:block th:fragment="content">

	<link rel="stylesheet" href="/css/reservation/information.css">
    
    <section class="member_login">
	    <div class="view reservation_list">
	    
		<div class="content-header">
			<div class="cormorant-font">Reservation</div>
			<p class="p_text_deco">ì˜ˆì•½ ì •ë³´ ì…ë ¥</p>
		</div>
	    
	    <div class="container">
	    <div>
	        <div class="form-group">
	            <label for="selectedTheme">ğŸ”‘ ì„ íƒí•œ í…Œë§ˆ</label>
	            <input type="text" class="form-control" id="selectedTheme" name="selectedTheme" readonly th:value="${selectedTheme}">
	        </div>
	
	        <div class="form-group">
	            <label for="reservationDate">ğŸ”‘ ì˜ˆì•½ ë‚ ì§œ</label>
	            <input type="date" class="form-control" id="reservationDate" name="reservationDate" readonly th:value="${reservationDate}">
	        </div>
	        
	        <div class="form-group">
	            <label for="selectedTime">ğŸ”‘ ì˜ˆì•½ ì‹œê°„</label>
	            <input type="text" class="form-control" id="time" name="selectedTime" readonly th:value="${selectedTime}">
	        </div>
	
	        <div class="form-group">
	            <label for="spot">ğŸ”‘ ì§€ì  ì„ íƒ</label>
	            <input type="text" class="form-control" id="spot" name="spot" readonly th:value="${spot}">
	        </div>
	
	<div class="form-group">
	            <label for="people">ğŸ”‘ ì¸ì› ìˆ˜</label>
	            <select class="form-control" id="people" name="people" required onchange="calculateAmount()">
	                <option value="" disabled selected>ì¸ì› ìˆ˜ ì„ íƒ</option>
	                <option value="2">2ëª…</option>
	                <option value="3">3ëª…</option>
	                <option value="4">4ëª…</option>
	                <option value="5">5ëª…</option>
	                <option value="6">6ëª…</option>
	            </select>
	        </div>
	
	        <div class="form-group">
	            <label for="amount">ğŸ”‘ ê²°ì œ ê¸ˆì•¡</label>
	            <input type="text" class="form-control" id="amount" name="amount" readonly>
	        </div>
			
			<div class="res_btn">
	        	<button onclick="insertReservationInfo()" class="btn btn-primary">ì˜ˆì•½í•˜ê¸°</button>
	        </div>
	        
	        <div class="res_link">
	            <a class="btn btn-secondary" th:href="@{/reservation/list}">ì´ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
	        </div>
	    </div>
		
		</div>
	
		</div>
	</section>
	
</div>

<script>
	/**
	 * POST ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê³µí†µ í•¨ìˆ˜
	 * @param {string} url - ìš”ì²­í•  URL
	 * @param {Object} data - ì„œë²„ì— ì „ì†¡í•  ë°ì´í„° (JSON í˜•ì‹)
	 * @param {Function} onSuccess - ìš”ì²­ì´ ì„±ê³µí–ˆì„ ë•Œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
	 * @param {Function} onError - ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
	 */
	async function postData(url, data, onSuccess, onError) {
	    try {
	        const response = await fetch(url, {
	            method: 'POST',
	            headers: {
	                'Content-Type': 'application/json',
	            },
	            body: JSON.stringify(data), // ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
	        });
	
	        if (response.ok) {
	            if (onSuccess) {
	                onSuccess(response); // ì„±ê³µ ì‹œ ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
	            }
	        } else {
	            throw new Error(`Error: ${response.status}`);
	        }
	    } catch (error) {
	        console.error('POST ìš”ì²­ ì—ëŸ¬:', error);
	        if (onError) {
	            onError(error); // ì‹¤íŒ¨ ì‹œ ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
	        }
	    }
	}
	
	 /*ì¸ì›ìˆ˜ì— ë”°ì€ ê²°ì œ ê¸ˆì•¡ */
    function calculateAmount() {
        const people = document.getElementById('people').value;
        const pricePerPerson = 22000; // <- í•˜ë“œì½”ë”© ì§€ì–‘
        if (people) {
            const amount = people * pricePerPerson;
            document.getElementById('amount').value = amount + "ì›";
        }
    }
	
	function insertReservationInfo() {
		/* ë³€ìˆ˜ ì„ ì–¸ */
		var url = '/reservation/information'
		
		var selectedTheme = document.querySelector('#selectedTheme').value;
		var reservationDate = document.querySelector('#reservationDate').value;
		var spot = document.querySelector('#spot').value;
		var people = document.querySelector('#people').value;
		var amount = document.querySelector('#amount').value;
		var time = document.querySelector('#time').value;
		
		var data = {
				selectedTheme : selectedTheme
				, reservationDate : reservationDate
				, spot : spot
				, people : people
				, amount : amount
				, time : time.replaceAll(' ', '')
		}
		
		
		/* ìœ íš¨ì„± ê²€ì¦ */
		if(people == '' || people == null){
			alert("ì¸ì›ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
			return;
		}
		postData(url, data, fn_success, fn_fail);
		
		function fn_success(){
			alert("ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.");
			
			// ì˜ˆì•½ ì„±ê³µ ì‹œ í˜ì´ì§€ ì´ë™
	        window.location.href = "http://localhost:8080/theme/theme-list";
		}
		
		function fn_fail(){
			alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
			 window.location.href  = "http://localhost:8080/escapelogin";
		}
		
	}
	
    function confirmReservation() {
        alert("ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return true;
    }
    
    
</script>
    
</th:block>
</th:block>